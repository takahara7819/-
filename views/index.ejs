<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.0/css/bootstrap-reboot.min.css">
        <title>一覧画面 - 顧客管理</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.js"></script>
    </head>
    <body>
        <button><a href="/create">新規登録</a></button>
        <div id="usersTable">
            <table>
                <thead>
                    <th>次回アポ日付</th>
                    <th>契約した売上</th>
                    <th>現在契約本数</th>
                    <th>会社名</th>
                    <th>会社名かな</th>
                    <th>資本金</th>
                    <th>従業員数</th>
                    <th>アポ先部署</th>
                    <th>担当者名</th>
                    <th>担当者名かな</th>
                    <th>URL</th>
                </thead>
                <tbody>
                    <% for (let i=0; i < users.length; i++) { %>
                        <tr>
                            <td>
                                <% var date2=users[i].NextAppointmentDate; var b=date2.toLocaleDateString(); %>
                                    <%- b %>
                            </td>
                            <td> ¥<%- users[i].sales.toLocaleString() %>
                            </td>
                            <td>
                                <%- users[i].CurrentContractCount %>
                            </td>
                            <td>
                                <%- users[i].CompanyName %>
                            </td>
                            <td>
                                <%- users[i].CompanyNameKana %>
                            </td>
                            <td> ¥<%- users[i].Capital.toLocaleString() %>
                            </td>
                            <td>
                                <%- users[i].EmployeesCount %>
                            </td>
                            <td>
                                <%- users[i].AppointmentDepartment %>
                            </td>
                            <td>
                                <%- users[i].ContactPersonName %>
                            </td>
                            <td>
                                <%- users[i].ContactPersonKana %>
                            </td>
                            <td>
                                <%- users[i].URL %>
                            </td>
                            <td class="bt">
                                <button><a href="/edit/<%- users[i].id %>">詳細情報</a></button>
                                <button><a href="/custom/<%- users[i].id %>">編集</a></button>
                            </td>
                        </tr>
                        <% } %>
                </tbody>
            </table>
        </div>
        <div id="usersSales">
            <h2>売上統計</h2>
            <p>契約売上合計金額: ¥<%= Number(Sales).toLocaleString() %></p>
            <p>目標売上合計金額: ¥<%= Number(Goal).toLocaleString() %></p>
            <p>全体目標金額まであと: ¥<%= (Goal-Sales).toLocaleString() %></p>
        </div>
        <canvas id="myBarChart"></canvas>
        <script>
            //グラフ描画
            const ctx = document.getElementById("myBarChart");
            const myBarChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['8月1日', '8月2日', '8月3日', '8月4日', '8月5日', '8月6日', '8月7日'],
                    datasets: [
                        {
                            label: 'A店 来客数',
                            data: [62, 65, 93, 85, 51, 66, 47],
                            backgroundColor: "rgba(219,39,91,0.5)"
                        }, {
                            label: 'B店 来客数',
                            data: [55, 45, 73, 75, 41, 45, 58],
                            backgroundColor: "rgba(130,201,169,0.5)"
                        }, {
                            label: 'C店 来客数',
                            data: [33, 45, 62, 55, 31, 45, 38],
                            backgroundColor: "rgba(255,183,76,0.5)"
                        }
                    ]
                },
                options: {
                    title: {
                        display: true,
                        text: '支店別 来客数'
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                suggestedMax: 100,
                                suggestedMin: 0,
                                stepSize: 10,
                                callback: function (value, index, values) {
                                    return value + '人'
                                }
                            }
                        }]
                    },
                }
            });


            //データ取得
            // function fetchData() {
            //     ajax({
            //         url: "/graphData",
            //         method: "GET",
            //         success: function (graph_user) {
            //             drawChart(graph_user);
            //         }
            //     });
            // }
            //グラフ描画
            // function drawChart(graph_user) {
            //     const gantt_options = {
            //         //ganttプロパティ
            //         data: graph_user,
            //     }
            //     $("#ganttContainer").gantt(gantt_options)
            // }

            // fetchData();
            // console.log(graph_user);

        </script>
        <style>
            a {
                text-decoration: none;
                color: #000;
            }

            table {
                border-collapse: collapse;
            }

            th,
            td {
                white-space: nowrap;
                text-align: center;
                border: 1px solid #ccc;
                padding: 10px;
            }

            td.bt {
                border: none;
            }

            thead {
                background-color: green;
                color: #fff;
            }

            button {
                margin: 5px;
            }

            .ganttContainer {
                width: 800px;
                height: 400px;
                border: 1px solid #ccc;
            }
        </style>
    </body>
</html>
